<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Timeline Prototype - Phuzzy's Think Tank</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            color: white;
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 30px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .demo-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        }
        
        .scenario-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .scenario-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #2d3748;
        }
        
        .correct-badge {
            padding: 8px 20px;
            border-radius: 25px;
            font-weight: 600;
            color: white;
            font-size: 0.9rem;
        }
        
        .badge-emotion { background: #ec4899; }
        .badge-balanced { background: #10b981; }
        
        .scenario-text {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            line-height: 1.8;
            font-size: 1.1rem;
            border-left: 5px solid #667eea;
        }
        
        .investigate-section {
            text-align: center;
            margin: 30px 0;
        }
        
        .investigate-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 30px;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .investigate-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        .investigate-button:active {
            transform: translateY(-1px);
        }
        
        .viz-container {
            display: none;
            margin-top: 30px;
            animation: slideIn 0.5s ease-out;
        }
        
        .viz-container.visible {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 30px;
        }
        
        .radar-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }
        
        .timeline-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
        }
        
        .section-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #4b5563;
            margin-bottom: 15px;
            text-align: center;
        }
        
        canvas {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            display: block;
            margin: 0 auto;
        }
        
        .scores-display {
            margin-top: 15px;
            font-size: 0.9rem;
            color: #6b7280;
        }
        
        .score-item {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            padding: 4px 8px;
            border-radius: 6px;
        }
        
        .score-fallacy { background: rgba(59, 130, 246, 0.1); }
        .score-emotion { background: rgba(236, 72, 153, 0.1); }
        .score-balanced { background: rgba(16, 185, 129, 0.1); }
        .score-agenda { background: rgba(245, 158, 11, 0.1); }
        
        .controls {
            background: rgba(255,255,255,0.9);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-top: 20px;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .legend {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .legend-color {
            width: 24px;
            height: 4px;
            border-radius: 2px;
        }
        
        .fallacy-color { background: #3b82f6; }
        .emotion-color { background: #ec4899; }
        .balanced-color { background: #10b981; }
        .agenda-color { background: #f59e0b; }
        
        .info-box {
            background: #e0f2fe;
            border: 1px solid #0288d1;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .info-title {
            font-weight: 600;
            color: #0277bd;
            margin-bottom: 8px;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .viz-container.visible {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .scenario-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .legend {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .scenario-title {
                font-size: 1.5rem;
            }
            
            canvas {
                max-width: 100%;
                height: auto;
            }
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üêª Enhanced Analysis Prototype</h1>
        
        <!-- Scenario 1: Fear-mongering with sales pitch -->
        <div class="demo-card">
            <div class="scenario-header">
                <h2 class="scenario-title">Neighborhood Watch Alert</h2>
                <span class="correct-badge badge-emotion">Emotional Manipulation</span>
            </div>
            
            <div class="scenario-text">
                Posted in NextDoor by Jim Maxwell: URGENT - BE AWARE!!! üö®üö®üö® I saw a van driving slowly down Oak Street yesterday. It had out-of-state plates!!! This is EXACTLY how those trafficking rings operate that I read about on Facebook. They're probably scouting our children! I called 911 but they said 'driving slowly isn't a crime' - can you BELIEVE that?? The police won't protect us, so WE must protect ourselves! Everyone needs to buy security cameras NOW. My brother sells them - DM me for a 'neighbor discount.' SHARE THIS TO SAVE LIVES!!!
            </div>
            
            <div class="investigate-section">
                <button class="investigate-button" onclick="toggleInvestigation('viz1')">
                    üîç Investigate Argument Pattern
                </button>
            </div>
            
            <div class="viz-container" id="viz1">
                <div class="radar-section">
                    <h3 class="section-title">Argument Fingerprint</h3>
                    <canvas id="radar1" width="320" height="320"></canvas>
                    <div class="scores-display">
                        <div class="score-item score-fallacy">
                            <span>Logical Fallacies:</span>
                            <strong>78.3%</strong>
                        </div>
                        <div class="score-item score-emotion">
                            <span>Emotional Manipulation:</span>
                            <strong>91.7%</strong>
                        </div>
                        <div class="score-item score-balanced">
                            <span>Balanced Analysis:</span>
                            <strong>4.2%</strong>
                        </div>
                        <div class="score-item score-agenda">
                            <span>Hidden Agenda:</span>
                            <strong>84.6%</strong>
                        </div>
                    </div>
                </div>
                
                <div class="timeline-section">
                    <h3 class="section-title">Language Evolution Timeline</h3>
                    <canvas id="timeline1" width="600" height="300"></canvas>
                </div>
            </div>
            
            <div class="info-box">
                <div class="info-title">Pattern Analysis:</div>
                Fear spikes immediately with "URGENT!!! üö®", logical fallacies peak with Facebook speculation, then agenda surges with camera sales pitch.
            </div>
        </div>
        
        <!-- Scenario 2: Balanced research -->
        <div class="demo-card">
            <div class="scenario-header">
                <h2 class="scenario-title">MIT Remote Work Study</h2>
                <span class="correct-badge badge-balanced">Well-Balanced</span>
            </div>
            
            <div class="scenario-text">
                MIT researchers concluded a 5-year study on remote work productivity: 'We tracked 2,400 employees across 15 companies. Overall productivity increased 13% for remote workers, but results varied by role. Creative tasks showed 22% improvement, while collaborative projects decreased 8% in efficiency. Employee satisfaction rose 31%, sick days dropped 25%. However, junior employees reported 40% less mentorship. Companies saving on office space averaged $11,000 per employee annually.'
            </div>
            
            <div class="investigate-section">
                <button class="investigate-button" onclick="toggleInvestigation('viz2')">
                    üîç Investigate Argument Pattern
                </button>
            </div>
            
            <div class="viz-container" id="viz2">
                <div class="radar-section">
                    <h3 class="section-title">Argument Fingerprint</h3>
                    <canvas id="radar2" width="320" height="320"></canvas>
                    <div class="scores-display">
                        <div class="score-item score-fallacy">
                            <span>Logical Fallacies:</span>
                            <strong>12.8%</strong>
                        </div>
                        <div class="score-item score-emotion">
                            <span>Emotional Manipulation:</span>
                            <strong>8.4%</strong>
                        </div>
                        <div class="score-item score-balanced">
                            <span>Balanced Analysis:</span>
                            <strong>96.2%</strong>
                        </div>
                        <div class="score-item score-agenda">
                            <span>Hidden Agenda:</span>
                            <strong>3.7%</strong>
                        </div>
                    </div>
                </div>
                
                <div class="timeline-section">
                    <h3 class="section-title">Language Evolution Timeline</h3>
                    <canvas id="timeline2" width="600" height="300"></canvas>
                </div>
            </div>
            
            <div class="info-box">
                <div class="info-title">Pattern Analysis:</div>
                Consistent balanced language throughout with qualifying words like "but", "however", "varied" maintaining scientific objectivity.
            </div>
        </div>
        
        <div class="controls">
            <button onclick="animateCharts()">üé¨ Animate All</button>
            <button onclick="resetCharts()">üîÑ Reset</button>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color fallacy-color"></div>
                <span><strong>Logical Fallacies:</strong> Weak evidence, false reasoning</span>
            </div>
            <div class="legend-item">
                <div class="legend-color emotion-color"></div>
                <span><strong>Emotional Manipulation:</strong> Fear, guilt, urgency tactics</span>
            </div>
            <div class="legend-item">
                <div class="legend-color balanced-color"></div>
                <span><strong>Balanced Analysis:</strong> Nuanced, fair presentation</span>
            </div>
            <div class="legend-item">
                <div class="legend-color agenda-color"></div>
                <span><strong>Hidden Agenda:</strong> Sales pitch, profit motive</span>
            </div>
        </div>
    </div>

    <script>
        // ===== ENHANCED RADAR CHART WITH BETTER LABELS =====
        class EnhancedRadarChart {
            constructor(canvasId) {
                this.canvas = document.getElementById(canvasId);
                this.ctx = this.canvas.getContext('2d');
                this.colors = {
                    fallacy: '#3b82f6',
                    emotion: '#ec4899',
                    balanced: '#10b981',
                    agenda: '#f59e0b'
                };
            }
            
            draw(scores) {
                const centerX = this.canvas.width / 2;
                const centerY = this.canvas.height / 2;
                const radius = 110; // Increased for better label spacing
                
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                // Background circles
                this.ctx.strokeStyle = '#e5e7eb';
                this.ctx.lineWidth = 1;
                for (let i = 1; i <= 4; i++) {
                    this.ctx.beginPath();
                    this.ctx.arc(centerX, centerY, radius * i / 4, 0, 2 * Math.PI);
                    this.ctx.stroke();
                }
                
                // Axes and improved labels
                this.ctx.strokeStyle = '#d1d5db';
                this.ctx.lineWidth = 2;
                const labels = ['Logical\nFallacies', 'Emotional\nManipulation', 'Balanced\nAnalysis', 'Hidden\nAgenda'];
                const positions = [
                    { x: 0, y: -1 }, // top
                    { x: 1, y: 0 },  // right  
                    { x: 0, y: 1 },  // bottom
                    { x: -1, y: 0 }  // left
                ];
                
                for (let i = 0; i < 4; i++) {
                    const pos = positions[i];
                    const x = centerX + radius * pos.x;
                    const y = centerY + radius * pos.y;
                    
                    // Draw axis line
                    this.ctx.beginPath();
                    this.ctx.moveTo(centerX, centerY);
                    this.ctx.lineTo(x, y);
                    this.ctx.stroke();
                    
                    // Enhanced label positioning with more padding
                    const labelX = centerX + (radius + 40) * pos.x;
                    const labelY = centerY + (radius + 40) * pos.y;
                    
                    this.ctx.fillStyle = Object.values(this.colors)[i];
                    this.ctx.font = 'bold 11px sans-serif';
                    this.ctx.textAlign = 'center';
                    this.ctx.textBaseline = 'middle';
                    
                    // Draw multi-line labels
                    const lines = labels[i].split('\n');
                    lines.forEach((line, lineIndex) => {
                        this.ctx.fillText(line, labelX, labelY + (lineIndex - 0.5) * 12);
                    });
                }
                
                // Data area with enhanced precision
                const values = [scores.fallacy, scores.emotion, scores.balanced, scores.agenda];
                this.ctx.beginPath();
                for (let i = 0; i < 4; i++) {
                    const pos = positions[i];
                    const value = values[i] / 100;
                    const x = centerX + radius * value * pos.x;
                    const y = centerY + radius * value * pos.y;
                    
                    if (i === 0) this.ctx.moveTo(x, y);
                    else this.ctx.lineTo(x, y);
                }
                this.ctx.closePath();
                
                // Fill and stroke
                this.ctx.fillStyle = 'rgba(102, 126, 234, 0.2)';
                this.ctx.fill();
                this.ctx.strokeStyle = '#667eea';
                this.ctx.lineWidth = 3;
                this.ctx.stroke();
                
                // Enhanced data points
                for (let i = 0; i < 4; i++) {
                    const pos = positions[i];
                    const value = values[i] / 100;
                    const x = centerX + radius * value * pos.x;
                    const y = centerY + radius * value * pos.y;
                    
                    this.ctx.beginPath();
                    this.ctx.arc(x, y, 5, 0, 2 * Math.PI);
                    this.ctx.fillStyle = Object.values(this.colors)[i];
                    this.ctx.fill();
                    this.ctx.strokeStyle = 'white';
                    this.ctx.lineWidth = 2;
                    this.ctx.stroke();
                    
                    // Add precise value labels
                    this.ctx.fillStyle = '#374151';
                    this.ctx.font = '10px sans-serif';
                    this.ctx.fillText(values[i].toFixed(1) + '%', x + 10, y - 10);
                }
            }
        }
        
        // ===== ENHANCED TIMELINE CHART =====
        class EnhancedTimelineChart {
            constructor(canvasId) {
                this.canvas = document.getElementById(canvasId);
                this.ctx = this.canvas.getContext('2d');
                this.colors = {
                    fallacy: '#3b82f6',
                    emotion: '#ec4899',
                    balanced: '#10b981',
                    agenda: '#f59e0b'
                };
                this.showAnnotations = true;
            }
            
            // Enhanced analysis with more realistic scoring
            analyzeText(text, keywords) {
                const sentences = text.match(/[^.!?]+[.!?]+/g) || [text];
                const data = [];
                
                sentences.forEach((sentence, index) => {
                    const scores = {
                        fallacy: this.scoreKeywords(sentence, keywords.fallacy, 0.8), // More nuanced multipliers
                        emotion: this.scoreKeywords(sentence, keywords.emotion, 1.2),
                        balanced: this.scoreKeywords(sentence, keywords.balanced, 0.9),
                        agenda: this.scoreKeywords(sentence, keywords.agenda, 1.1)
                    };
                    
                    // Add some realistic variance
                    Object.keys(scores).forEach(key => {
                        scores[key] *= (0.9 + Math.random() * 0.2); // ¬±10% variance
                        scores[key] = Math.min(100, scores[key]);
                    });
                    
                    data.push({
                        sentence: sentence.trim(),
                        position: index / Math.max(1, sentences.length - 1),
                        scores
                    });
                });
                
                return data;
            }
            
            scoreKeywords(sentence, keywords, multiplier = 1) {
                let score = 0;
                keywords.forEach(keyword => {
                    const regex = new RegExp(keyword.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi');
                    const matches = sentence.match(regex);
                    if (matches) {
                        score += matches.length * Math.min(12, keyword.length) * multiplier;
                    }
                });
                return Math.min(100, score * 1.8);
            }
            
            draw(text, keywords) {
                const data = this.analyzeText(text, keywords);
                const padding = 50;
                const width = this.canvas.width - padding * 2;
                const height = this.canvas.height - padding * 2;
                
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                // Background grid
                this.ctx.strokeStyle = '#f3f4f6';
                this.ctx.lineWidth = 1;
                for (let i = 0; i <= 4; i++) {
                    const y = padding + height - (height * i / 4);
                    this.ctx.beginPath();
                    this.ctx.moveTo(padding, y);
                    this.ctx.lineTo(padding + width, y);
                    this.ctx.stroke();
                    
                    // Y labels
                    this.ctx.fillStyle = '#6b7280';
                    this.ctx.font = '11px sans-serif';
                    this.ctx.textAlign = 'right';
                    this.ctx.fillText((i * 25) + '%', padding - 5, y + 3);
                }
                
                // Draw lines for each dimension
                Object.keys(this.colors).forEach(dimension => {
                    this.drawLine(data, dimension, padding, width, height);
                });
                
                // Annotations
                if (this.showAnnotations) {
                    this.drawAnnotations(data, padding, width, height, keywords);
                }
                
                // X-axis label
                this.ctx.fillStyle = '#374151';
                this.ctx.font = '12px sans-serif';
                this.ctx.textAlign = 'center';
                this.ctx.fillText('Reading Progress ‚Üí', padding + width / 2, this.canvas.height - 10);
            }
            
            drawLine(data, dimension, padding, width, height) {
                if (data.length < 2) return;
                
                this.ctx.strokeStyle = this.colors[dimension];
                this.ctx.lineWidth = 2.5;
                this.ctx.lineCap = 'round';
                
                this.ctx.beginPath();
                data.forEach((point, index) => {
                    const x = padding + point.position * width;
                    const y = padding + height - (point.scores[dimension] / 100 * height);
                    
                    if (index === 0) this.ctx.moveTo(x, y);
                    else this.ctx.lineTo(x, y);
                });
                this.ctx.stroke();
                
                // Draw points for significant values
                data.forEach(point => {
                    if (point.scores[dimension] > 15) {
                        const x = padding + point.position * width;
                        const y = padding + height - (point.scores[dimension] / 100 * height);
                        
                        this.ctx.beginPath();
                        this.ctx.arc(x, y, 3, 0, 2 * Math.PI);
                        this.ctx.fillStyle = this.colors[dimension];
                        this.ctx.fill();
                    }
                });
            }
            
            drawAnnotations(data, padding, width, height, keywords) {
                // Find highest peaks
                const peaks = {};
                Object.keys(this.colors).forEach(dimension => {
                    let maxScore = 0;
                    let maxIndex = 0;
                    
                    data.forEach((point, index) => {
                        if (point.scores[dimension] > maxScore) {
                            maxScore = point.scores[dimension];
                            maxIndex = index;
                        }
                    });
                    
                    if (maxScore > 25) {
                        peaks[dimension] = { index: maxIndex, score: maxScore };
                    }
                });
                
                // Draw peak annotations (limit to 2 for clarity)
                Object.entries(peaks).slice(0, 2).forEach(([dimension, peak]) => {
                    const point = data[peak.index];
                    const x = padding + point.position * width;
                    const y = padding + height - (peak.score / 100 * height);
                    
                    // Find matching keyword
                    const sentence = point.sentence.toLowerCase();
                    const matchedKeyword = keywords[dimension].find(keyword => 
                        sentence.includes(keyword.toLowerCase())
                    );
                    
                    if (matchedKeyword) {
                        // Draw annotation
                        this.ctx.fillStyle = this.colors[dimension];
                        this.ctx.beginPath();
                        this.ctx.roundRect(x - 50, y - 35, 100, 25, 5);
                        this.ctx.fill();
                        
                        // Text
                        this.ctx.fillStyle = 'white';
                        this.ctx.font = 'bold 11px sans-serif';
                        this.ctx.textAlign = 'center';
                        
                        const displayNames = {
                            fallacy: 'Fallacy',
                            emotion: 'Emotion',
                            balanced: 'Balanced',
                            agenda: 'Agenda'
                        };
                        
                        this.ctx.fillText(displayNames[dimension], x, y - 20);
                        this.ctx.font = '9px sans-serif';
                        this.ctx.fillText('"' + matchedKeyword + '"', x, y - 8);
                        
                        // Arrow
                        this.ctx.fillStyle = this.colors[dimension];
                        this.ctx.beginPath();
                        this.ctx.moveTo(x, y - 10);
                        this.ctx.lineTo(x - 5, y - 5);
                        this.ctx.lineTo(x + 5, y - 5);
                        this.ctx.fill();
                    }
                });
            }
        }
        
        // ===== DEMO DATA WITH REALISTIC SCORES =====
        const scenarios = {
            neighborhood: {
                scores: { 
                    fallacy: 78.3, 
                    emotion: 91.7, 
                    balanced: 4.2, 
                    agenda: 84.6 
                },
                text: `Posted in NextDoor by Jim Maxwell: URGENT - BE AWARE!!! üö®üö®üö® I saw a van driving slowly down Oak Street yesterday. It had out-of-state plates!!! This is EXACTLY how those trafficking rings operate that I read about on Facebook. They're probably scouting our children! I called 911 but they said 'driving slowly isn't a crime' - can you BELIEVE that?? The police won't protect us, so WE must protect ourselves! Everyone needs to buy security cameras NOW. My brother sells them - DM me for a 'neighbor discount.' SHARE THIS TO SAVE LIVES!!!`,
                keywords: {
                    fallacy: ['EXACTLY how', 'Facebook', 'probably', 'BELIEVE'],
                    emotion: ['URGENT', 'BE AWARE', 'üö®', 'trafficking', 'our children', 'protect ourselves', 'SAVE LIVES'],
                    balanced: ['police said', 'driving slowly'],
                    agenda: ['buy security cameras', 'My brother sells', 'neighbor discount', 'DM me']
                }
            },
            mit: {
                scores: { 
                    fallacy: 12.8, 
                    emotion: 8.4, 
                    balanced: 96.2, 
                    agenda: 3.7 
                },
                text: `MIT researchers concluded a 5-year study on remote work productivity: 'We tracked 2,400 employees across 15 companies. Overall productivity increased 13% for remote workers, but results varied by role. Creative tasks showed 22% improvement, while collaborative projects decreased 8% in efficiency. Employee satisfaction rose 31%, sick days dropped 25%. However, junior employees reported 40% less mentorship. Companies saving on office space averaged $11,000 per employee annually.'`,
                keywords: {
                    fallacy: ['5-year study', '2,400 employees', '15 companies', 'tracked'],
                    emotion: ['satisfaction', 'improvement'],
                    balanced: ['Overall', 'but', 'However', 'varied by role', 'while'],
                    agenda: ['$11,000', 'saving']
                }
            }
        };
        
        // ===== INITIALIZE CHARTS =====
        const radar1 = new EnhancedRadarChart('radar1');
        const radar2 = new EnhancedRadarChart('radar2');
        const timeline1 = new EnhancedTimelineChart('timeline1');
        const timeline2 = new EnhancedTimelineChart('timeline2');
        
        // Draw initial charts
        function drawCharts() {
            radar1.draw(scenarios.neighborhood.scores);
            radar2.draw(scenarios.mit.scores);
            timeline1.draw(scenarios.neighborhood.text, scenarios.neighborhood.keywords);
            timeline2.draw(scenarios.mit.text, scenarios.mit.keywords);
        }
        
        // ===== INTERACTION CONTROLS =====
        function toggleInvestigation(vizId) {
            const viz = document.getElementById(vizId);
            const isVisible = viz.classList.contains('visible');
            
            if (!isVisible) {
                viz.classList.add('visible');
                // Draw charts when becoming visible
                setTimeout(drawCharts, 100);
            } else {
                viz.classList.remove('visible');
            }
        }
        
        function animateCharts() {
            drawCharts();
        }
        
        function resetCharts() {
            drawCharts();
        }
        
        // Helper for rounded rectangles
        if (!CanvasRenderingContext2D.prototype.roundRect) {
            CanvasRenderingContext2D.prototype.roundRect = function(x, y, w, h, r) {
                this.beginPath();
                this.moveTo(x + r, y);
                this.lineTo(x + w - r, y);
                this.quadraticCurveTo(x + w, y, x + w, y + r);
                this.lineTo(x + w, y + h - r);
                this.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
                this.lineTo(x + r, y + h);
                this.quadraticCurveTo(x, y + h, x, y + h - r);
                this.lineTo(x, y + r);
                this.quadraticCurveTo(x, y, x + r, y);
                this.closePath();
            };
        }
    </script>
</body>
</html>